<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <title>Codeage - Notifikasi yang Lebih Keras, Bagus, Cepat dan Kuat</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/id/feed.xml" />
    <link rel="apple-touch-icon" sizes="57x57" href="/icon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/icon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/icon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/icon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/icon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/icon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/icon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icon/favicon-16x16.png">
    <link rel="manifest" href="/icon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/icon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <link href="/stylesheets/all.css" rel="stylesheet" />
  </head>
  <body>

    <div id="main" role="main">
      <nav>
  <h1 class="blog-title"><a href="/id/">Codeage</a></h1>
  <p class="blog-description">
    Pardon my ramblings about code and such
  </p>
  <div class="blog-lang">
    <a href="/blog/en/harder-better-faster-stronger-notification.html">English</a> / <strong>Bahasa Indonesia</strong>
  </div>
</nav>


      <article>
        <h1>Notifikasi yang Lebih Keras, Bagus, Cepat dan Kuat</h1>
        <p>Di tempat saya bekerja sekarang, kami sedang memikirkan ulang cara lain mengkomunikasikan perubahan yang terjadi di kelas model. Perubahan ini harus tersiarkan ke kelas-kelas lain. Sepertinya, ini akan terdengar sebagai contoh kasus yang tepat untuk memperkenalkan konsep reaktif, namun ini bukan artikel untuk menjelaskan bagaimana menggunakan <code>ReactiveCococa</code> atau <code>RxSwift</code>. Sebaliknya, perkenankan saya mengingatkan kembali kepada teman lama kita, <code>Notification</code> and <code>NotificationCenter</code>. </p>

<h2>Kebutuhan</h2>

<p>Di artikel ini, saya akan bercerita tentang kebutuhan dan rancangan sementara versi lebih baiknya kelas <code>Notification</code> (atau yang di masanya dikenal sebagai <code>NSNotification</code>). Harap dicatat artikel ini hanya akan membahas kelas <code>Notification</code> yang <em>custom</em>. Notifikasi <code>UIKit</code> adalah di luar cakupan artikel ini.</p>

<p><img title="Harder better faster stronger" alt="harder_better" src="/blog/2017-03-26-harder-better-faster-stronger-notification/harder_better.jpg" /></p>

<ul>
<li><strong>Harder</strong>, lebih sulit untuk membuat kesalahan. Tidak ada lagi menamakan notifikasi dengan <code>String</code>.</li>
<li><strong>Better</strong>, kompatibilitas yang lebih baik dengan Objective-C. Aplikasi kami berumur 5 tahun, sehingga penting untuk bisa digunakan oleh kelas-kelas Objective-C.</li>
<li><strong>Faster</strong>, penciptaan <em>post</em> dan <em>observer</em> yang cepat. Menyiarkan dan mendengarkan perubahan akan menjadi lebih mudah.</li>
<li><strong>Stronger</strong>, informasi tipe yang lebih kuat. <code>Notification</code> mempunyai tipe informasi yang lemah, Anda bisa memberikan kelas apapun sebagai <code>object</code>-nya dan <em>dictionary</em> apapun sebagai <code>userInfo</code>-nya.</li>
</ul>

<p><em>Memang kebutuhannya ini sedikit terdengar memaksa, saya membuatnya agar referensi Daft Punk saya relevan dengan artikel ini.</em></p>

<h2>Rancangan 1: Rancangan dari Swift Talk</h2>

<p>Langkah awal saya diinspirasikan dari pekerjaan orang lain, adalah Chris dan Florian dari <a href="https://talk.objc.io">Swift Talk</a> yang mengajarkan pemirsanya bagaimana membungkus <code>Notification</code> menggunakan protokol. Ide dasarnya adalah protokol tersebut mempunyai nama untuk notifikasi dan objeknya itu sendiri di-<em>assign</em> sebagai <code>object</code>-nya.</p>
<div class="highlight swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre></td><td class="code"><pre>
<span class="c1">// MARK: Rancangan 1</span>
<span class="kd">protocol</span> <span class="kt">Notifiable</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">notificationName</span><span class="p">:</span> <span class="kt">Notification</span><span class="o">.</span><span class="kt">Name</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">NotificationCenter</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="n">post</span><span class="o">&lt;</span><span class="kt">A</span><span class="p">:</span> <span class="kt">Notifiable</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">notifiable</span><span class="p">:</span> <span class="kt">A</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">post</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="kt">A</span><span class="o">.</span><span class="n">notificationName</span><span class="p">,</span> <span class="nv">object</span><span class="p">:</span> <span class="n">notifiable</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="n">observe</span><span class="o">&lt;</span><span class="kt">A</span><span class="p">:</span> <span class="kt">Notifiable</span><span class="o">&gt;</span><span class="p">(</span><span class="n">using</span> <span class="nv">block</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">NSObjectProtocol</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nf">addObserver</span><span class="p">(</span><span class="nv">forName</span><span class="p">:</span> <span class="kt">A</span><span class="o">.</span><span class="n">notificationName</span><span class="p">,</span> <span class="nv">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">queue</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">notification</span> <span class="k">in</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">notif</span> <span class="o">=</span> <span class="n">notification</span><span class="o">.</span><span class="n">object</span> <span class="k">as?</span> <span class="kt">A</span> <span class="p">{</span>
                <span class="nf">block</span><span class="p">(</span><span class="n">notif</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>

<p>Mari kita buat contoh sederhana untuk memperjelas rancangan ini dan kenapa ini lebih baik dari rancangan <code>Notification</code> sebelumnya. Misalkan kita mempunyai <em>counter</em> global di aplikasi kita dan kita mau mendapatkan nilainya setiap kali ada perubahan. Kita akan membuat kelas notifikasi <code>CounterDidChangeNotification</code> yang memenuhi protokol <code>Notifable</code>. Kita menggunakan kelas daripada <em>struct</em> karena ini akan digunakan oleh kelas Objective-C juga. Jangan lupa gunakan <a href="/blog/id/how-to-name-your-notification.html">nama yang bagus untuk kelas notifikasimu</a>.</p>
<div class="highlight swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></td><td class="code"><pre>
<span class="c1">// MARK: Rancangan 1 - call site</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="kt">CounterDidChangeNotification</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">count</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">count</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">count</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">CounterDidChangeNotification</span><span class="p">:</span> <span class="kt">Notifiable</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">notificationName</span><span class="p">:</span> <span class="kt">Notification</span><span class="o">.</span><span class="kt">Name</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">Notification</span><span class="o">.</span><span class="kt">Name</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="s">"CounterDidChangeNotification"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: Post and observe 'CounterDidChangeNotification'</span>
<span class="n">notificationCenter</span><span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="kt">CounterDidChangeNotification</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="n">notificationCenter</span><span class="o">.</span><span class="n">observe</span> <span class="p">{</span> <span class="p">(</span><span class="nv">notification</span><span class="p">:</span> <span class="kt">CounterDidChangeNotification</span><span class="p">)</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"latest count </span><span class="se">\(</span><span class="n">notification</span><span class="o">.</span><span class="n">count</span><span class="se">)</span><span class="s">"</span><span class="p">)</span> <span class="c1">// akan mencetak "latest count 10"</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>

<p>Rancangan antarmuka <code>Notification</code> kita sekarang lebih aman dan lebih punya informasi ketimbang antarmuka dari <code>Foundation</code>. Bila kita ingin menyiarkan menggunakan yang disediakan <code>Foundation</code>, fungsinya memerlukan namanya dan juga objek yang bisa jadi apa saja atau bahkan <code>nil</code> . Cara mendengerkan notifikasi dari <code>Foundation</code> juga tidak kalah ribet, fungsinya sama juga memerlukan nama dan <em>block</em>-nya harus mengetahui caranya mengambil informasi dari kelas <code>Notification</code>, bisa saja <code>object</code>-nya yang penting, atau informasi di dalam <code>userInfo</code> yang penting.</p>

<p>Sedangkan di rancangan <code>Notification</code> kita, sewaktu menyiarkan kita tinggal membuat instansi dari <code>Notifiable</code> lalu disiarkan menggunakan fungsi <code>post</code>. Mendengarkan notifikasi lebih canggih lagi, kita tinggal memberikan informasi tentang kelas apa yang kita sedang ingin dengarkan di dalam <em>block</em>. Swift cukup pintar untuk mendapatkan informasi tersebut hanya dari tipenya (untuk kasus ini adalah dari kode <code>{ (notification: CounterDidChangeNotification) in ... }</code>). Sisa informasi seperti nama dan bagaiaman cara mengolah objek notifikasi sudah diurus oleh fungsi yang kita tulis.</p>

<h2>Rancangan 2: Penamaan Otomatis</h2>

<p>Kita bisa membuat rancangan pertama lebih baik lagi yaitu menggunakan nama kelas kita sebagai nama notifikasi dengan ekstensi protokol kita.</p>
<div class="highlight swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="c1">// MARK: Rancangan 2</span>
<span class="kd">protocol</span> <span class="kt">Notifiable</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">notificationName</span><span class="p">:</span> <span class="kt">Notification</span><span class="o">.</span><span class="kt">Name</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Notifiable</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">notificationName</span><span class="p">:</span> <span class="kt">Notification</span><span class="o">.</span><span class="kt">Name</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">Notification</span><span class="o">.</span><span class="kt">Name</span><span class="p">(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="k">self</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>

<p>Kita tidak perlu memberikan nama secara manual lagi kepada notifikasi kita karena implementasi ekstensi protokol <code>Notifiable</code> akan menggunakan nama kelas itu sendiri. Perlu dicatat, kita tetap bisa memberikan nama secara manual jika diperlukan dengan cara mengimplementasikan properti <code>notificationName</code> di kelas kita.</p>

<p>Kelas <code>CounterDidChangeNotification</code> kita sudah lebih sederhana, sekarang kita bisa membuat kelas tersebut bisa disiarkan hanya dengan membubuhi protokol <code>Notifiable</code>.</p>
<div class="highlight swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="c1">// MARK: Rancangan 2 - call site</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="kt">CounterDidChangeNotification</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">Notifiable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">count</span><span class="p">:</span> <span class="kt">Int</span>

    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">count</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">count</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>

<p>Sekarang, menyiarkan sebuah kelas menjadi bertambah mudah, mantap! 👍</p>

<p><img title="great" alt="great" src="/blog/2017-03-26-harder-better-faster-stronger-notification/dp.gif" /></p>

<h2>Rancangan 3: Teman lama kita</h2>

<p>Sekarang bagian yang tersulit: Objective-C. Mari kita lihat fungsi <code>NotificationCenter</code> kita di <em>header file</em>.</p>
<div class="highlight objective_c"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="k">@interface</span> <span class="nc">NSNotificationCenter</span> <span class="p">(</span><span class="n">SWIFT_EXTENSION</span><span class="p">(</span><span class="n">Notification</span><span class="p">))</span>
<span class="k">@end</span>
</pre></td></tr></tbody></table>
</div>

<p>Apakah kita bisa lihat fungsi ekstensi yang sudah kita tambahkan? Nah, itu dia, Objective-C tidak mengertik konsep ekstensi protokol dan fungsi generik dari Swift. Jadi bagaimana caranya agar kelas kita dapat digunakan oleh kelas-kelas Objective-C?</p>

<p>Langkah pertama, kita ubah protokol <code>Notifiable</code> menjadi kelas basis sehingga kita bisa membuat kelas-kelas turunannya mempunyai cara menamakan notifikasinya secara dinamis.</p>

<p>Terkadang membuat kode yang kompatibel dengan Objective-C terasa seperti berjalan mundur. Seringkali kita dengar &ldquo;Jangan gunakan <em>subclassing</em> kalau tidak mau kelas mempunyai tingkah laku yang sulit dicari asalnya darimana, gunakan ekstensi protokol, dsb&rdquo;. <em>Subclassing</em> itu sah-sah saja, tidak ada yang buruk dengan itu. <em>Subclassing</em> adalah salah satu kakas yang baik, apalagi untuk kasus kita yang memerlukan kompatibilitas dengan Objective-C dan hanya mempunyai satu tingkat keturunan.</p>
<div class="highlight swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="c1">// MARK: Rancangan 3</span>
<span class="kd">class</span> <span class="kt">Notifiable</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">notificationName</span><span class="p">:</span> <span class="kt">Notification</span><span class="o">.</span><span class="kt">Name</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">Notification</span><span class="o">.</span><span class="kt">Name</span><span class="p">(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="k">self</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>

<p>Langkah selanjutnya, kita membuat fungsi <code>post</code> kita kompatibel dengan Objective-C dengan cara mengganti tipe generik dengan kelas baru <code>Notifiable</code>. Fungsi satunya lagi, <code>observe</code> sedikit lebih rumit. Kemampuan Objective-C dalam mengenal kelas generik terbatas, sehingga kita memberikan informasi tipe kelas kita lewat parameter. Rancangan ini memang tidak mempunyai informasi selengkap fungsi pasangannya di Swift, tapi paling tidak kita bisa membuatnya lebih aman karena <em>block</em> yang kita berikan tidak akan terpanggil jika tipenya tidak sesuai.</p>

<p>Cara kerjanya seperti petugas imigrasi saja, mereka menyocokkan visa turis dengan negara kunjungannya, bila turis punya visa yang benar maka petugas akan mengizinkan turis melewati gerbang imigrasi. Nah mirip-mirip, fungsi kita akan menyocokkan nama kelas dari object notifikasi dan nama kelas dari parameter, bila nama objek notifikasi benar maka fungsi kita akan memanggil <em>block</em> dengan menggunakan objek tersebut.</p>
<div class="highlight swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre><span class="c1">// MARK: Lanjutan Rancangan 3</span>
<span class="kd">func</span> <span class="nf">post</span><span class="p">(</span><span class="nv">notifiable</span><span class="p">:</span> <span class="kt">Notifiable</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">post</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="nf">type</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">notifiable</span><span class="p">)</span><span class="o">.</span><span class="n">notificationName</span><span class="p">,</span> <span class="nv">object</span><span class="p">:</span> <span class="n">notifiable</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">observe</span><span class="p">(</span><span class="nv">classType</span><span class="p">:</span> <span class="kt">Notifiable</span><span class="o">.</span><span class="k">Type</span><span class="p">,</span> <span class="n">using</span> <span class="nv">block</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="kt">NSObjectProtocol</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nf">addObserver</span><span class="p">(</span><span class="nv">forName</span><span class="p">:</span> <span class="n">classType</span><span class="o">.</span><span class="n">notificationName</span><span class="p">,</span> <span class="nv">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">queue</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">notification</span> <span class="k">in</span>

        <span class="k">guard</span> <span class="k">let</span> <span class="nv">notificationObject</span> <span class="o">=</span> <span class="n">notification</span><span class="o">.</span><span class="n">object</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        <span class="k">let</span> <span class="nv">expectedType</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">classType</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">type</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="nf">type</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">notificationObject</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">expectedType</span> <span class="o">==</span> <span class="n">type</span>  <span class="p">{</span>
            <span class="nf">block</span><span class="p">(</span><span class="n">notificationObject</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>

<p>Sekarang mari kita cek kembali <em>header file</em> kita, maka 2 fungsi kita akan terlihat di ekstensi <code>NotificationCenter</code>!</p>
<div class="highlight objective_c"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="k">@interface</span> <span class="nc">NSNotificationCenter</span> <span class="p">(</span><span class="n">SWIFT_EXTENSION</span><span class="p">(</span><span class="n">Notification</span><span class="p">))</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">postWithNotifiable</span><span class="o">:</span><span class="p">(</span><span class="n">Notifiable</span> <span class="o">*</span> <span class="p">)</span><span class="n">notifiable</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">id</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span><span class="p">)</span><span class="nf">observeWithClassType</span><span class="p">:(</span><span class="n">SWIFT_METATYPE</span><span class="p">(</span><span class="n">Notifiable</span><span class="p">))</span><span class="nv">classType</span> <span class="nf">using</span><span class="p">:(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">id</span><span class="p">))</span><span class="nv">block</span><span class="p">;</span>
<span class="k">@end</span>
</pre></td></tr></tbody></table>
</div>

<p>Langkah terakhir, adalah gunakan fungsi <code>observe</code> baru kita dengan cara <em>force cast</em> type <code>id</code> dengan kelas yang kita inginkan. Lihat seksama bagaimana parameter tipe di parameter pertama harus sama dengan tipe yang digunakan <em>block</em> di parameter kedua.</p>
<div class="highlight objective_c"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="c1">// MARK: Rancangan 3 - call site
</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">notificationCenter</span>
    <span class="nf">observeWithClassType</span><span class="p">:</span><span class="n">CounterDidChangeNotification</span><span class="p">.</span><span class="n">class</span>
    <span class="nf">using</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">CounterDidChangeNotification</span> <span class="o">*</span><span class="n">notification</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"latest count %ld"</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">notification</span><span class="p">.</span><span class="n">count</span><span class="p">)</span> <span class="c1">// akan mencetak "latest count 10"
</span><span class="p">}];</span>
</pre></td></tr></tbody></table>
</div>

<p>Ajib! Sekarang kita mempunyai rancangan fungsi untuk menyiarkan dan mendengarkan notifikasi yang kompatibel di dua bahasa (Swift dan Objective-C) 🙌 Saya cukup puas dengan rancangan ini, namun bila ada ide atau teknik yang bisa membuat kelas <code>Notification</code> ini lebih aman dan mudah digunakan, mohon bagi-bagi.</p>

<p>Untuk melihat bagaimana cara kerja kelas <code>Notification</code> di atas, saya mempersiapkan aplikasi contoh bila memerlukan : <strong>Notification sample</strong> (<a href="/blog/2017-03-26-harder-better-faster-stronger-notification/Notification.zip">zip</a>, <a href="https://github.com/ikhsan/ikhsan.github.io/tree/develop/source/blog/2017-03-26-harder-better-faster-stronger-notification/Notification/Notification">github</a>).</p>

        <div class="metadata">
          <div class="date">Mar.26 2017</div>
              <a class="tag" href="/blog/tags/notification.html">notification</a>
    <a class="tag" href="/blog/tags/objective-c.html">objective-c</a>
    <a class="tag" href="/blog/tags/swift.html">swift</a>

        </div>
      </article>
      
<div class="article-links">
  <div class="previous-link">
    <a href="/blog/id/how-to-name-your-notification.html">&larr; Cara Menamakan Kelas Notifikasi</a>
  </div>

  <div class="next-link">
    <a href="/blog/id/three-steps-to-run-application-on-your-apple-device-without-developer-account.html">3 Langkah Menjalakan Aplikasi iOS di Perangkat Apple Tanpa Akun Developer &rarr;</a>
  </div>

</div>


      <footer>
  <div class="footer-blog">
    <p>Saya Ikhsan dan ini adalah blog saya tentang pemikiran seputar koding. Hal-hal selain kodingan saya tulis di blog utama, <a href="http://ikhsan.me">Lifeage</a>. Kontak saya via Twitter <a href="http://twitter.com/ixnixnixn">@ixnixnixn</a> atau langsung saja email di <a href="mailto:ikhsan.assaat@gmail.com">ikhsan.assaat@gmail.com</a>.</p>
  </div>

  <div class="footer-links">
    <ul>
      <li><a href="/id/articles.html">Artikel</a></li>
      <li><a href="http://ikhsan.me">Lifeage</a></li>
      <li><a href="http://twitter.com/ixnixnixn">Twitter</a></li>
      <li><a href="http://github.com/ikhsan">Github</a></li>
    </ul>
  </div>

  <div class="copyright">
    <p>&copy; <a href="https://github.com/ikhsan/ikhsan.github.io">Codeage</a> 2009–2017</p>
  </div>
</footer>

    </div>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-12712252-2', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>
